name: build docker image

on:
    workflow_call:

jobs:
    build:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v4
          with:
                ref: main
        - name: Update branch protection
          uses: Hatzelencio/branch-protection@v1.0.0
          env:
              GITHUB_TOKEN: ${{secrets.MY_GITHUB_TOKEN}} 
          with:
              path: .github/config/main-branch-protection.yml
                 
        - name: package
          run: mvn clean install
          shell: bash
        - name: Build an image from Dockerfile
          run: |
            docker build -t docker.io/hdteck/springboot.backend:${{ github.sha }} .
          shell: bash
          
    release:
      needs: 'build'
      uses: ./.github/workflows/workflow-release.yml
